---
title: "[Next.js] React Query SSR로 LCP 76% 개선하기"
date: "2025-05-25"
description: "개인 프로젝트로 AWS App Runner에 배포해둔 백엔드 서버가 하나 있다. 몇 년치 나스닥 상위 대형주들의 주가 데이터를 Neon이라는 DB 서비스에 저장하고 있고, 현재는 증시 마감 시간에 맞춰 매일 Cron 작업을 통해 전날 마감 주가 업로드를 자동화해두었다. 이번 게시글에서는 이 주가 데이터를 Next.js 기반 프론트엔드 애플리케이션에 React Query + SSR 방식으로 효율적으로 렌더링하고, 그 결과로 LCP(Largest Contentful Paint)를 약 76% 개선한 과정을 정리해본다. 특히, SSG와 CSR 방식과 비교했을 때, 초기 페이지 로딩 속도 개선이 어떤 방식으로 이루어졌는지 실제 Lighthouse 분석 결과를 바탕으로 설명할 예정이다."
thumbnail: "thumbnail.png"
category: "Frontend"
subcategory: "Next.js"
tags: []
---

## 들어가며

개인 프로젝트로 `AWS App Runner`에 배포해둔 백엔드 서버가 하나 있다. 몇 년치 나스닥 상위 대형주들의 주가 데이터를 Neon이라는 DB 서비스에 저장하고 있고, 현재는 증시 마감 시간에 맞춰 매일 `Cron` 작업을 통해 전날 마감 주가 업로드를 자동화해두었다.

이번 게시글에서는 이 주가 데이터를 Next.js 기반 프론트엔드 애플리케이션에 **React Query + SSR** 방식으로 효율적으로 렌더링하고, 그 결과로 **LCP**(**Largest Contentful Paint**)를 **약 76% 개선**한 과정을 정리해본다. 특히, SSG와 CSR 방식과 비교했을 때, 초기 페이지 로딩 속도 개선이 어떤 방식으로 이루어졌는지 실제 Lighthouse 분석 결과를 바탕으로 설명할 예정이다.

## App Router 기반 프로젝트 구조

프로젝트는 Next.js 15.2 App Router 구조를 기반으로 개발하였다. App Router는 중첩 레이아웃, 서버 컴포넌트 기반의 SSR, SSR-CSR의 유연한 혼합 등 다양한 장점을 제공하기 때문에 Page Router보다 확장성과 유지보수가 좋다. 그렇기 때문에 기존 Page Router에서 사용하던 `getServerSideProps`와 같은 데이터 패칭 함수가 전혀 필요하지 않다. App Router 구조에서는 서버 컴포넌트 자체가 SSR의 진입점이 되며, 파일 상단에 `use client` 디렉티브가 없는 컴포넌트는 자동으로 Next.js가 서버 컴포넌트로 간주된다.

따라서 App Router에서 SSR을 구현하는 일은 생각보다 단순하다. 별도의 데이터 패칭 함수 없이, 서버 컴포넌트(예: `page.tsx`) 내에서 `await`를 활용해 직접 데이터를 불러오고, 이를 JSX에 렌더링하면 된다.

현재 디렉토리 구조는 다음과 같이 구성되어 있다. 참고로, 디렉토리 구조는 `tree src`로 조회 가능하다.

```zsh
➜  wetopia git:(main) ✗ tree src
src
├── app
│   ├── layout.tsx
│   └── page.tsx
├── components
│   ├── base
│   ├── block
│   └── domain
│   │   └── stock
│   │       ├── index.ts
│   │       ├── StockChart.tsx
│   │       └── StockChartContainer.tsx
├── constants
├── hooks
│   ├── index.ts
│   └── useStockDashboard.ts
├── lib
│   └── api
│       ├── axios.ts
│       └── stock.api.ts
├── providers
│   ├── index.ts
│   ├── clientProvider.tsx # <-- ChakraProvider + RecoilRoot
│   └── reactQueryHydrator.tsx # <-- React Query Client Provider
...

16 directories, 32 files
```

이 구조는 서버에서 데이터를 미리 패칭하고, 클라이언트에서 hydrate하는 구조에 최적화되도록 초점을 맞췄으며, `/components/*` 경로에 클라이언트 컴포넌트를 배치하고, 공용 훅 및 API 레이어는 각각 `/hooks`와 `/lib/api`에 분리시켰다. (혹여 서버 컴포넌트 또는 hydrate에 대해 궁금하다면 [정리해둔 게시글](https://www.0biglife.com/posts/server-component)을 참고하자)

### /constants/endpoints

앞으로 붙이게 될 엔드포인트들을 모아둔 파일이다. `${API_ENDPOINTS.STOCK.DASHBOARD}` 방식으로 가져다쓰면 명시적이고, 앤드포인트가 많아질수록 유지보수하기에 좋다.

```ts
const API = "/api";

export const API_ENDPOINTS = {
  STOCK: {
    DASHBOARD: `${API}/stock/dashboard`,
    // DETAIL: (symbol: string) => `${API}/stock/${symbol}`,
  },
  // ...
};
```
